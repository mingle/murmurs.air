<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<link rel="stylesheet" href="css/murmurs.css" type="text/css" media="screen" charset="utf-8" />
	<title>Mingle Murmurs</title>
  <!-- <script src="vendor/air/AIRIntrospector.js" type="text/javascript" charset="utf-8"></script> -->
	<script src="vendor/jquery/jquery-1.3.2.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" charset="utf-8">
   // window.console = air.Introspector.Console;
	 MurmurView = function(murmur) {	   
	   this.render = function(container) {
       var arrow = $('<span class="arrow-to-right"><span></span></span>')
	     var author = $('<span class="author"></span>').text(murmur.author.name)
       var content = $('<div class="content"></div>').text(murmur.content)
       var body = $('<div class="body"></div>').append(arrow).append(author).append(content)
       var icon = $('<div class="icon-wrapper"><img class="icon" src="' + murmur.author.icon_path + '"></img>')
       var murmur_element = $('<div class="murmur"></div>').append(icon).append(body)
       container.append(murmur_element)
	   }
	 }
	 
	 function url(user, password) {
      return "http://localhost:3000/api/v2/projects/alm/murmurs.xml";
	 }
	 
	 $(function() {
	   $("#status").text("loading...")
	   $.ajax({ 
  	   dataType: 'xml',
  	   url: url(), 
  	   cache: false,

  	   success: function(xml) {
         $("#status").text("")
  	     $("murmurs murmur", xml).each(function(){
  	       var murmur = {
             content: $("body", this).text(),
             author: {
               name: $("author name", this).text(),
               icon_path: "http://localhost:3000" + $("author icon_path", this).text()
             }
  	       }
  	       new MurmurView(murmur).render($("#container"))
  	     })
  	   }
  	  });
	 })
	 
	</script>
	<body>
	  <div id="container">
	  </div>
	  
	  <div id="status_bar">
	    <button>post</button>
	    <span id="status"></span>
	  </div>
  </body>
</html>